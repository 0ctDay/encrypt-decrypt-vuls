{"version":3,"sources":["webpack:///./src/views/BookWithUser.vue","webpack:///./src/views/BookWithUser.vue?4e1b"],"names":["class","style","inline","size","label","search1","placeholder","clearable","prefix","search2","user","role","search3","type","load","clear","title","deleteBatch","reference","data","tableData","stripe","border","handleSelectionChange","width","prop","sortable","fixed","handleEdit","scope","row","handleDelete","handlereProlong","disabled","prolong","currentPage","page-sizes","page-size","pageSize","layout","total","handleSizeChange","handleCurrentChange","dialogVisible2","footer","save","model","form","label-width","isbn","bookName","nickName","created","userStr","sessionStorage","getItem","this","JSON","parse","name","methods","val","forms","length","request","post","then","res","code","success","error","msg","warning","get","params","pageNum","console","log","records","id","form3","stringify","nowDate","Date","deadtime","setDate","getDate","format","message","form2","dialogVisible","__exports__","render"],"mappings":"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","file":"js/chunk-2d0c0df2.9b822a3f.js","sourcesContent":["<template>\r\n  <div class=\"home\" style =\"padding: 10px\">\r\n    <!-- 搜索-->\r\n    <div style=\"margin: 10px 0;\">\r\n\r\n      <el-form inline=\"true\" size=\"small\" >\r\n        <el-form-item label=\"图书编号\" >\r\n          <el-input v-model=\"search1\" placeholder=\"请输入图书编号\"  clearable>\r\n            <template #prefix><el-icon class=\"el-input__icon\"><search/></el-icon></template>\r\n          </el-input>\r\n        </el-form-item >\r\n        <el-form-item label=\"图书名称\" >\r\n          <el-input v-model=\"search2\" placeholder=\"请输入图书名称\"  clearable>\r\n            <template #prefix><el-icon class=\"el-input__icon\"><search /></el-icon></template>\r\n          </el-input>\r\n        </el-form-item >\r\n        <el-form-item label=\"借阅者\" v-if=\"user.role == 1\">\r\n          <el-input v-model=\"search3\" placeholder=\"请输入借阅者昵称\"  clearable>\r\n            <template #prefix><el-icon class=\"el-input__icon\"><search /></el-icon></template>\r\n          </el-input>\r\n        </el-form-item >\r\n        <el-form-item>\r\n          <el-button type=\"primary\" style=\"margin-left: 1%\" @click=\"load\" size=\"mini\">查询</el-button>\r\n        </el-form-item>\r\n        <el-form-item>\r\n          <el-button size=\"mini\"  type=\"danger\" @click=\"clear\">重置</el-button>\r\n        </el-form-item>\r\n      </el-form>\r\n    </div>\r\n    <!-- 按钮-->\r\n    <div style=\"margin: 10px 0;\" >\r\n      <el-popconfirm title=\"确认删除?\" @confirm=\"deleteBatch\" v-if=\"user.role == 1\">\r\n        <template #reference>\r\n          <el-button type=\"danger\" size=\"mini\" >批量删除</el-button>\r\n        </template>\r\n      </el-popconfirm>\r\n    </div>\r\n    <!-- 数据字段-->\r\n    <el-table :data=\"tableData\" stripe border=\"true\" @selection-change=\"handleSelectionChange\">\r\n      <el-table-column v-if=\"user.role ==1\"\r\n          type=\"selection\"\r\n          width=\"55\">\r\n      </el-table-column>\r\n      <el-table-column prop=\"isbn\" label=\"图书编号\" sortable />\r\n      <el-table-column prop=\"bookName\" label=\"图书名称\" />\r\n      <el-table-column prop=\"nickName\" label=\"借阅者\" />\r\n      <el-table-column prop=\"lendtime\" label=\"借阅时间\" />\r\n      <el-table-column prop=\"deadtime\" label=\"最迟归还日期\" />\r\n      <el-table-column prop=\"prolong\" label=\"可续借次数\" />\r\n      <el-table-column fixed=\"right\" label=\"操作\" >\r\n        <template v-slot=\"scope\">\r\n          <el-button  size=\"mini\" @click =\"handleEdit(scope.row)\" v-if=\"user.role == 1\">修改</el-button>\r\n          <el-popconfirm title=\"确认删除?\" @confirm=\"handleDelete(scope.row) \" v-if=\"user.role == 1\">\r\n            <template #reference>\r\n              <el-button type=\"danger\" size=\"mini\" >删除</el-button>\r\n            </template>\r\n          </el-popconfirm>\r\n          <el-popconfirm title=\"确认续借(续借一次延长30天)?\" @confirm=\"handlereProlong(scope.row)\" v-if=\"user.role == 2\" :disabled=\"scope.row.prolong == 0\">\r\n            <template #reference>\r\n              <el-button type=\"danger\" size=\"mini\" :disabled=\"scope.row.prolong == 0\" >续借</el-button>\r\n            </template>\r\n          </el-popconfirm>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n    <!--    分页-->\r\n    <div style=\"margin: 10px 0\">\r\n      <el-pagination\r\n          v-model:currentPage=\"currentPage\"\r\n          :page-sizes=\"[5, 10, 20]\"\r\n          :page-size=\"pageSize\"\r\n          layout=\"total, sizes, prev, pager, next, jumper\"\r\n          :total=\"total\"\r\n          @size-change=\"handleSizeChange\"\r\n          @current-change=\"handleCurrentChange\"\r\n      >\r\n      </el-pagination>\r\n\r\n      <el-dialog v-model=\"dialogVisible2\" title=\"修改借阅信息\" width=\"30%\">\r\n        <el-form :model=\"form\" label-width=\"120px\">\r\n\r\n          <el-form-item label=\"图书编号\">\r\n            <el-input style=\"width: 80%\" v-model=\"form.isbn\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"图书名称\">\r\n            <el-input style=\"width: 80%\" v-model=\"form.bookName\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"借阅者\">\r\n            <el-input style=\"width: 80%\" v-model=\"form.nickName\"></el-input>\r\n          </el-form-item>\r\n          <el-form-item label=\"续借次数\">\r\n            <el-input style=\"width: 80%\" v-model=\"form.prolong\"></el-input>\r\n          </el-form-item>\r\n        </el-form>\r\n        <template #footer>\r\n      <span class=\"dialog-footer\">\r\n        <el-button @click=\"dialogVisible2 = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"save\">确 定</el-button>\r\n      </span>\r\n        </template>\r\n      </el-dialog>\r\n\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n// @ is an alias to /src\r\nimport request from \"../utils/request\";\r\nimport {ElMessage} from \"element-plus\";\r\nimport moment from \"moment\";\r\nexport default {\r\n  created(){\r\n    let userStr = sessionStorage.getItem(\"user\") ||\"{}\"\r\n    this.user = JSON.parse(userStr)\r\n    this.load()\r\n  },\r\n  name: 'bookwithuser',\r\n  methods: {\r\n\r\n    handleSelectionChange(val){\r\n      this.forms = val\r\n    },\r\n    deleteBatch(){\r\n      if (!this.forms.length) {\r\n        ElMessage.warning(\"请选择数据！\")\r\n        return\r\n      }\r\n    //  一个小优化，直接发送这个数组，而不是一个一个的提交删除\r\n      request.post(\"bookwithuser/deleteRecords\",this.forms).then(res =>{\r\n        if(res.code === '0'){\r\n          ElMessage.success(\"批量删除成功\")\r\n          this.load()\r\n        }\r\n        else {\r\n          ElMessage.error(res.msg)\r\n        }\r\n      })\r\n    },\r\n    load(){\r\n      if(this.user.role == 1){\r\n        request.get(\"/bookwithuser\",{\r\n          params:{\r\n            pageNum: this.currentPage,\r\n            pageSize: this.pageSize,\r\n            search1: this.search1,\r\n            search2: this.search2,\r\n            search3: this.search3,\r\n          }\r\n        }).then(res =>{\r\n          console.log(res)\r\n          this.tableData = res.data.records\r\n          this.total = res.data.total\r\n        })\r\n      }\r\n      else {\r\n        request.get(\"/bookwithuser\",{\r\n          params:{\r\n            pageNum: this.currentPage,\r\n            pageSize: this.pageSize,\r\n            search1: this.search1,\r\n            search2: this.search2,\r\n            search3: this.user.id,\r\n          }\r\n        }).then(res =>{\r\n          console.log(res)\r\n          this.tableData = res.data.records\r\n          this.total = res.data.total\r\n        })\r\n      }\r\n    },\r\n    clear(){\r\n      this.search1 = \"\"\r\n      this.search2 = \"\"\r\n      this.search3 = \"\"\r\n      this.load()\r\n    },\r\n    handleDelete(row){\r\n      const form3 = JSON.parse(JSON.stringify(row))\r\n      request.post(\"bookwithuser/deleteRecord\",form3).then(res =>{\r\n        console.log(res)\r\n        if(res.code == 0 ){\r\n          ElMessage.success(\"删除成功\")\r\n        }\r\n        else\r\n          ElMessage.error(res.msg)\r\n        this.load()\r\n      })\r\n    },\r\n    handlereProlong(row){\r\n      var nowDate = new Date(row.deadtime);\r\n      nowDate.setDate(nowDate.getDate()+30);\r\n      row.deadtime = moment(nowDate).format(\"yyyy-MM-DD HH:mm:ss\");\r\n      row.prolong = row.prolong -1;\r\n      request.post(\"/bookwithuser\",row).then(res =>{\r\n        console.log(res)\r\n        if(res.code == 0){\r\n          ElMessage({\r\n            message: '续借成功',\r\n            type: 'success',\r\n          })\r\n        }\r\n        else {\r\n          ElMessage.error(res.msg)\r\n        }\r\n        this.load()\r\n        this.dialogVisible2 = false\r\n      })\r\n    },\r\n    save(){\r\n      //ES6语法\r\n      //地址,但是？IP与端口？+请求参数\r\n      // this.form?这是自动保存在form中的，虽然显示时没有使用，但是这个对象中是有它的\r\n        request.post(\"/bookwithuser\",this.form).then(res =>{\r\n          console.log(res)\r\n          if(res.code == 0){\r\n            ElMessage({\r\n              message: '修改信息成功',\r\n              type: 'success',\r\n            })\r\n          }\r\n          else {\r\n            ElMessage.error(res.msg)\r\n          }\r\n          this.load()\r\n          this.dialogVisible2 = false\r\n        })\r\n    },\r\n\r\n    handleEdit(row){\r\n      this.form = JSON.parse(JSON.stringify(row))\r\n      this.dialogVisible2 = true\r\n    },\r\n    handleSizeChange(pageSize){\r\n      this.pageSize = pageSize\r\n      this.load()\r\n    },\r\n    handleCurrentChange(pageNum){\r\n      this.pageNum = pageNum\r\n      this.load()\r\n    },\r\n\r\n  },\r\n  data() {\r\n    return {\r\n      form: {},\r\n      form2:{},\r\n      form3:{},\r\n      dialogVisible: false,\r\n      dialogVisible2: false,\r\n      search1:'',\r\n      search2:'',\r\n      search3:'',\r\n      total:10,\r\n      currentPage:1,\r\n      pageSize: 10,\r\n      tableData: [],\r\n      user:{},\r\n      forms:[],\r\n    }\r\n  },\r\n}\r\n</script>\r\n","import { render } from \"./BookWithUser.vue?vue&type=template&id=1cf804b8\"\nimport script from \"./BookWithUser.vue?vue&type=script&lang=js\"\nexport * from \"./BookWithUser.vue?vue&type=script&lang=js\"\n\nimport exportComponent from \"C:\\\\Users\\\\Administrator4\\\\Desktop\\\\library-system\\\\vue\\\\node_modules\\\\vue-loader-v16\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"sourceRoot":""}